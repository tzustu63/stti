<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket 連線測試</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .log {
        background: #f5f5f5;
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        font-family: monospace;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
      }
    </style>
  </head>
  <body>
    <h1>WebSocket 連線測試</h1>
    <div id="status">未連線</div>
    <button onclick="connect()">連線</button>
    <button onclick="sendTest()">發送測試訊息</button>
    <div id="log" class="log"></div>

    <script>
      let ws = null;

      function log(message) {
        const logDiv = document.getElementById("log");
        const timestamp = new Date().toLocaleTimeString();
        logDiv.innerHTML += `[${timestamp}] ${message}\n`;
        console.log(message);
      }

      function connect() {
        const wsUrl = "ws://localhost:3000";
        log(`嘗試連接到: ${wsUrl}`);

        ws = new WebSocket(wsUrl);

        ws.onopen = () => {
          log("WebSocket 連線已建立");
          document.getElementById("status").textContent = "已連線";
        };

        ws.onclose = (event) => {
          log(`WebSocket 連線已關閉: ${event.code} ${event.reason}`);
          document.getElementById("status").textContent = "已斷線";
        };

        ws.onerror = (error) => {
          log(`WebSocket 錯誤: ${error}`);
          document.getElementById("status").textContent = "連線錯誤";
        };

        ws.onmessage = (event) => {
          log(`收到訊息: ${event.data}`);
        };
      }

      function sendTest() {
        if (ws && ws.readyState === WebSocket.OPEN) {
          const message = {
            type: "config",
            sourceLang: "zh",
            targetLang: "en",
          };
          ws.send(JSON.stringify(message));
          log("發送測試訊息: " + JSON.stringify(message));
        } else {
          log("WebSocket 未連線");
        }
      }
    </script>
  </body>
</html>

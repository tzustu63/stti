éå¸¸å¥½ ğŸ‘
ä»¥ä¸‹æ˜¯æˆ‘æ ¹æ“šæ‚¨æœ€æ–°çš„éœ€æ±‚ï¼ˆâœ… **ç§»é™¤è³‡æ–™åº«**ã€âœ… **ç°¡åŒ– UI layout**ï¼‰å¾Œï¼Œé‡æ–°æ•´ç†çš„ä¸‰å¤§é …ç›®ç‰ˆæœ¬ã€‚
é€™ä»½çµæ§‹å·²å¯ç›´æ¥äº¤çµ¦ **Cursor** ç”Ÿæˆå¯éƒ¨ç½²æ–¼ **Railway** çš„ç¨‹å¼ç¢¼ã€‚

---

# ä¸€ã€ç³»çµ±æ¶æ§‹è¨­è¨ˆï¼ˆå‰ç«¯ã€å¾Œç«¯ã€API ç­‰ï¼‰

## ğŸ–¥ï¸ å‰ç«¯ï¼ˆReact 18 + Viteï¼‰

- **æŠ€è¡“æ£§**ï¼šReact + TailwindCSS + Axios + WebSocket
- **éƒ¨ç½²æ–¹å¼**ï¼šå‰ç«¯æ‰“åŒ…æˆéœæ…‹æª”ï¼ˆVite buildï¼‰ï¼Œç”±å¾Œç«¯ Express æä¾› `/public` éœæ…‹æœå‹™ã€‚
- **ç‹€æ…‹ç®¡ç†**ï¼šZustand / Context APIï¼ˆè¼•é‡å³æ™‚æ›´æ–°ï¼‰
- **UI ä»‹é¢å¸ƒå±€**

```
+-----------------------------------------------------------+
| Header: Logo | èªè¨€è¼¸å…¥ â–¼ | èªè¨€è¼¸å‡º â–¼ |
+-----------------------------------------------------------+
| ä¸Šï¼šåŸæ–‡é€å­—ç¨¿ï¼ˆpartial â†’ final é€æ­¥é«˜äº®é¡¯ç¤ºï¼‰           |
| ä¸‹ï¼šç¿»è­¯çµæœï¼ˆåªé¡¯ç¤º final å®Œæˆçš„ç¿»è­¯æ–‡å­—ï¼‰              |
|                                                          |
|                                                          |
+-----------------------------------------------------------+
```

- **ä¸»è¦äº’å‹•**

  - ã€ŒèªéŸ³è¼¸å…¥ã€æŒ‰éˆ•ï¼šå•Ÿå‹•æˆ–åœæ­¢éŒ„éŸ³ã€‚
  - ã€Œèªè¨€è¼¸å…¥ã€èˆ‡ã€Œèªè¨€è¼¸å‡ºã€ä¸‹æ‹‰é¸å–®ï¼š
    æ”¯æ´èªè¨€ â†’ ä¸­æ–‡ã€è‹±æ–‡ã€å°å°¼æ–‡ã€è¶Šå—æ–‡ã€æ³°æ–‡ã€è‘¡è„ç‰™æ–‡ã€è¥¿ç­ç‰™æ–‡ã€æ—¥æ–‡ã€éŸ“æ–‡ã€‚

- **RWD æ”¯æ´**ï¼šæ‰‹æ©Ÿèˆ‡æ¡Œé¢ç‰ˆçš†é©ç”¨ã€‚

---

## âš™ï¸ å¾Œç«¯ï¼ˆNode.js + Express + WebSocketï¼‰

- **ä¸»è¦è·è²¬**

  - æä¾› REST APIï¼ˆèªè¨€åˆ—è¡¨ã€å¥åº·æª¢æŸ¥ï¼‰ã€‚
  - æä¾› WebSocket é€£ç·šçµ¦å‰ç«¯ï¼Œç”¨æ–¼å‚³éå³æ™‚èªéŸ³è³‡æ–™èˆ‡ç¿»è­¯çµæœã€‚
  - ä»£ç†æ•´åˆå¤–éƒ¨ APIï¼ˆGLADIAã€DeepLï¼‰ã€‚
  - æä¾›éœæ…‹æª”æœå‹™ï¼ˆå‰ç«¯ build çµæœï¼‰ã€‚

- **API åˆ—è¡¨**

  | ç«¯é»              | æ–¹æ³• | æè¿°                           |
  | ----------------- | ---- | ------------------------------ |
  | `/api/languages`  | GET  | å‚³å›æ”¯æ´çš„èªè¨€æ¸…å–®             |
  | `/api/transcribe` | POST | ï¼ˆéå³æ™‚æ¨¡å¼ï¼‰ä¸Šå‚³éŸ³è¨Šæª”è½‰æ–‡å­— |
  | `/api/translate`  | POST | ç¿»è­¯æ–‡å­—å…§å®¹                   |
  | `/healthz`        | GET  | Railway å¥åº·æª¢æŸ¥ç«¯é»           |

- **WebSocket æµç¨‹**

  1. å‰ç«¯é€£ç·š `/ws`ã€‚
  2. å‚³é€è¨­å®šï¼ˆsourceLangã€targetLangï¼‰ã€‚
  3. å‚³é€éŸ³è¨Šå°åŒ…ï¼ˆbase64 PCM / Opusï¼‰ã€‚
  4. ä¼ºæœå™¨ä¸²æ¥ GLADIA â†’ æ¥æ”¶é€å­—ç¨¿ partial / finalã€‚
  5. æ¯ç•¶ final å¥è½åœ°ï¼Œé€å¾€ DeepL â†’ å›å‚³ç¿»è­¯çµæœã€‚
  6. å°‡çµæœä»¥äº‹ä»¶æµæ¨æ’­çµ¦å‰ç«¯ã€‚

- **éƒ¨ç½²è¨­å®šï¼ˆç¬¦åˆ Railwayï¼‰**

  - ç›£è½ `0.0.0.0`
  - ä½¿ç”¨ `process.env.PORT`
  - æä¾› `/healthz` ç«¯é»
  - ç’°å¢ƒè®Šæ•¸ï¼š

    ```
    GLADIA_API_KEY=xxxx
    DEEPL_API_KEY=xxxx
    ALLOWED_ORIGINS=https://ä½ çš„ç¶²åŸŸ
    ```

  - æ¨è–¦ `railway.json`

    ```json
    {
      "$schema": "https://railway.com/railway.schema.json",
      "build": { "buildCommand": "npm ci && npm run build" },
      "deploy": {
        "startCommand": "node server/dist/index.js",
        "healthcheckPath": "/healthz"
      }
    }
    ```

---

## ğŸŒ API å°æ‡‰æ¶æ§‹

**å¤–éƒ¨ APIï¼š**

- GLADIA Realtime â†’ éŸ³è¨Šè½‰æ–‡å­—
- DeepL API â†’ ç¿»è­¯é€å­—ç¨¿

**å…§éƒ¨è³‡æ–™æµï¼š**

```
Browser Mic ğŸ¤
   â†“
[WebSocket /ws]
   â†“
[Express Server]
   â†“â”€â”€â–¶ GLADIA API â†’ Transcript (partial / final)
   â†“â”€â”€â–¶ DeepL API â†’ Translation (final only)
   â†“
Browser UI Render (ä¸Š=åŸæ–‡ï¼Œä¸‹=ç¿»è­¯)
```

---

# äºŒã€å®šç¾©è³‡æ–™æµèˆ‡æ¨¡çµ„é—œä¿‚

### ğŸ” æ•´é«”è³‡æ–™æµ

1. **ç”¨æˆ¶æ“ä½œ**

   - é¸æ“‡è¼¸å…¥èªè¨€èˆ‡è¼¸å‡ºèªè¨€ã€‚
   - é»æ“Šã€Œé–‹å§‹éŒ„éŸ³ã€ã€‚

2. **éŸ³è¨Šæµä¸Šå‚³**

   - å‰ç«¯å°‡éŸ³è¨Šå³æ™‚å°åŒ…ï¼Œé€é WebSocket å‚³çµ¦å¾Œç«¯ã€‚

3. **èªéŸ³è¾¨è­˜**

   - å¾Œç«¯å‘¼å« GLADIA_API å–å¾—é€å­—ç¨¿ç‰‡æ®µã€‚
   - æ¯æ¬¡ partial çµæœå³æ™‚å‚³å›å‰ç«¯æ›´æ–°ã€‚

4. **ç¿»è­¯è™•ç†**

   - ç•¶å¥å­ç‚º finalï¼ˆç¢ºå®šå¥å°¾ï¼‰ï¼Œå¾Œç«¯å‘¼å« DeepL å–å¾—ç¿»è­¯ã€‚
   - ç¿»è­¯å®Œæˆå¾Œæ¨æ’­å›å‰ç«¯æ›´æ–°ã€Œä¸‹æ–¹å€å¡Šã€ã€‚

5. **é¡¯ç¤ºçµæœ**

   - é é¢ä¸ŠåŠéƒ¨æŒçºŒæ›´æ–°é€å­—ç¨¿ã€‚
   - é é¢ä¸‹åŠéƒ¨åƒ…é¡¯ç¤ºå®Œæ•´ç¿»è­¯å¥å­ã€‚

6. **çµæŸéŒ„éŸ³**

   - ç”¨æˆ¶æŒ‰ã€Œåœæ­¢ã€ï¼ŒWebSocket é—œé–‰ï¼Œæœƒè©±çµæŸã€‚

---

### ğŸ§© æ¨¡çµ„é—œä¿‚

| æ¨¡çµ„åç¨±                 | åŠŸèƒ½                             | å°å¤–ä»‹é¢             |
| ------------------------ | -------------------------------- | -------------------- |
| **Front-End UI**         | éŸ³è¨Šæ”¶é›†ã€é¡¯ç¤ºåŸæ–‡/ç¿»è­¯          | `/ws`ã€`/api/*`      |
| **WebSocket Gateway**    | ç®¡ç†éŸ³è¨Šæµã€è½‰ç™¼è‡³ GLADIA        | `/ws`                |
| **ASR Adapter (Gladia)** | è™•ç†èªéŸ³è­˜åˆ¥ API è«‹æ±‚            | Gladia API           |
| **Translator (DeepL)**   | ç¿»è­¯ final å¥                    | DeepL API            |
| **Express API Layer**    | ç®¡ç† REST APIã€CORSã€healthcheck | `/api/*`, `/healthz` |
| **Static File Server**   | æä¾›å‰ç«¯æ‰“åŒ…æª”æ¡ˆ                 | `/public/*`          |

---

# ä¸‰ã€UI Wireframe èˆ‡ API æ–‡ä»¶

## ğŸ§­ UI Wireframeï¼ˆæ›´æ–°ç‰ˆï¼‰

```
+-----------------------------------------------------------+
| Header: Logo | èªè¨€è¼¸å…¥ â–¼ | èªè¨€è¼¸å‡º â–¼ |
+-----------------------------------------------------------+
| ä¸Šï¼šåŸæ–‡é€å­—ç¨¿ï¼ˆpartial â†’ final é«˜äº®é¡¯ç¤ºï¼‰                |
| ä¸‹ï¼šç¿»è­¯çµæœï¼ˆåªé¡¯ç¤º final ç¿»è­¯ï¼‰                        |
|                                                         |
|                                                         |
+-----------------------------------------------------------+
```

**äº’å‹•èªªæ˜ï¼š**

- èªè¨€ä¸‹æ‹‰ï¼šå¯å‹•æ…‹åˆ‡æ›èªè¨€ï¼ˆæ”¯æ´ zh / en / id / vi / th / pt / es / ja / koï¼‰
- éŒ„éŸ³æŒ‰éˆ•ï¼šé–‹å§‹ / æš«åœ / åœæ­¢
- ç¿»è­¯çµæœå³æ™‚æ›´æ–°ï¼Œä¸‹æ–¹åŒæ­¥é¡¯ç¤ºæœ€æ–° final ç¿»è­¯æ–‡å­—

---

## ğŸ”Œ API æ–‡ä»¶ï¼ˆREST + WebSocketï¼‰

### **1. GET `/api/languages`**

å–å¾—æ”¯æ´èªè¨€åˆ—è¡¨ã€‚

```json
{
  "input": ["zh", "en", "id", "vi", "th", "pt", "es", "ja", "ko"],
  "output": ["zh", "en", "id", "vi", "th", "pt", "es", "ja", "ko"]
}
```

---

### **2. POST `/api/transcribe`**

éå³æ™‚æ¨¡å¼ï¼Œä¾›æ¸¬è©¦æˆ–ä¸Šå‚³éŸ³è¨Šæª”ä½¿ç”¨ã€‚

```json
Request:
{ "audioUrl": "https://example.com/file.wav", "sourceLang": "ja" }

Response:
{ "transcript": "é€™æ˜¯ä¸€æ®µæ—¥æ–‡é€å­—ç¨¿ã€‚" }
```

---

### **3. POST `/api/translate`**

ç¿»è­¯ä»»æ„æ–‡å­—ã€‚

```json
Request:
{
  "text": "ã“ã‚“ã«ã¡ã¯",
  "sourceLang": "ja",
  "targetLang": "zh"
}

Response:
{ "translatedText": "ä½ å¥½" }
```

---

### **4. WebSocket `/ws`**

ç”¨æ–¼å³æ™‚èªéŸ³å‚³è¼¸èˆ‡çµæœæ¨æ’­ã€‚

**Client â†’ Server**

```json
{ "type": "config", "sourceLang": "en", "targetLang": "es" }
{ "type": "audio_chunk", "data": { "chunk": "<base64 PCM>" } }
{ "type": "stop_recording" }
```

**Server â†’ Client**

```json
{ "type": "transcript", "data": { "is_final": false, "utterance": { "text": "hello", "start": 0, "end": 0.48, "confidence": 0.91, "words": [] } } }
{ "type": "transcript", "data": { "is_final": true, "utterance": { "text": "hello world", "start": 0, "end": 1.2, "confidence": 0.95, "words": [] } } }
{ "type": "translation", "data": { "translated_utterance": { "text": "hola mundo" } } }
```

---

### **5. GET `/healthz`**

å¥åº·æª¢æŸ¥ï¼ˆRailway æª¢æ¸¬ç”¨ï¼‰

```json
{ "ok": true }
```

---

## âœ… ç³»çµ±æ•ˆèƒ½èˆ‡éåŠŸèƒ½éœ€æ±‚

| é¡åˆ¥   | è¦æ±‚                                                               |
| ------ | ------------------------------------------------------------------ |
| æ•ˆèƒ½   | é é¢è¼‰å…¥ < 3 ç§’ã€API å›æ‡‰ < 500msã€å³æ™‚ç¿»è­¯å»¶é² < 1.5 ç§’           |
| å®‰å…¨æ€§ | é˜²æ­¢ XSSã€CSRFã€API key ä¸æš´éœ²ï¼ˆåƒ…ä¼ºæœå™¨ç«¯å‘¼å«ï¼‰                   |
| ç›¸å®¹æ€§ | æ”¯æ´æœ€æ–°å…©ç‰ˆæœ¬çš„ Chrome / Edge / Safari / Firefox                  |
| éƒ¨ç½²   | ä»¥ GitHub æ¨é€ â†’ Railway è‡ªå‹•éƒ¨ç½²ï¼›æ”¯æ´ Dockerfile æˆ– railway.json |

---

## ğŸ§  é–‹ç™¼å»ºè­°çµ¦ Cursor

> ã€Œè«‹ä¾æ“šä¸Šè¿°æ¶æ§‹ï¼Œå»ºç«‹ React + Express å°ˆæ¡ˆï¼Œåœ¨ Railway ä¸Šè‡ªå‹•éƒ¨ç½²ã€‚
> å‰ç«¯ï¼šVite + TailwindCSSã€‚
> å¾Œç«¯ï¼šExpress + WebSocketï¼Œä½¿ç”¨ process.env.PORTã€listen 0.0.0.0ï¼Œå« /healthzã€‚
> æ•´åˆ GLADIA èˆ‡ DeepL APIï¼Œä¸¦å¯¦ä½œèªè¨€é¸æ“‡èˆ‡å³æ™‚é€å­—ç¨¿/ç¿»è­¯é¡¯ç¤ºã€‚ã€

---

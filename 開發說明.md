非常好 👍
以下是我根據您最新的需求（✅ **移除資料庫**、✅ **簡化 UI layout**）後，重新整理的三大項目版本。
這份結構已可直接交給 **Cursor** 生成可部署於 **Railway** 的程式碼。

---

# 一、系統架構設計（前端、後端、API 等）

## 🖥️ 前端（React 18 + Vite）

- **技術棧**：React + TailwindCSS + Axios + WebSocket
- **部署方式**：前端打包成靜態檔（Vite build），由後端 Express 提供 `/public` 靜態服務。
- **狀態管理**：Zustand / Context API（輕量即時更新）
- **UI 介面布局**

```
+-----------------------------------------------------------+
| Header: Logo | 語言輸入 ▼ | 語言輸出 ▼ | ⚙ |
+-----------------------------------------------------------+
| 上：原文逐字稿（partial → final 逐步高亮顯示）           |
| 下：翻譯結果（只顯示 final 完成的翻譯文字）              |
|                                                          |
|                                                          |
+-----------------------------------------------------------+
```

- **主要互動**

  - 「語音輸入」按鈕：啟動或停止錄音。
  - 「語言輸入」與「語言輸出」下拉選單：
    支援語言 → 中文、英文、印尼文、越南文、泰文、葡萄牙文、西班牙文、日文、韓文。
  - ⚙ 設定按鈕：選擇「快速模式（低延遲）」或「精準模式（高正確率）」。

- **RWD 支援**：手機與桌面版皆適用。

---

## ⚙️ 後端（Node.js + Express + WebSocket）

- **主要職責**

  - 提供 REST API（語言列表、健康檢查）。
  - 提供 WebSocket 連線給前端，用於傳遞即時語音資料與翻譯結果。
  - 代理整合外部 API（GLADIA、DeepL）。
  - 提供靜態檔服務（前端 build 結果）。

- **API 列表**

  | 端點              | 方法 | 描述                           |
  | ----------------- | ---- | ------------------------------ |
  | `/api/languages`  | GET  | 傳回支援的語言清單             |
  | `/api/transcribe` | POST | （非即時模式）上傳音訊檔轉文字 |
  | `/api/translate`  | POST | 翻譯文字內容                   |
  | `/healthz`        | GET  | Railway 健康檢查端點           |

- **WebSocket 流程**

  1. 前端連線 `/ws`。
  2. 傳送設定（sourceLang、targetLang、mode）。
  3. 傳送音訊封包（base64 PCM / Opus）。
  4. 伺服器串接 GLADIA → 接收逐字稿 partial / final。
  5. 每當 final 句落地，送往 DeepL → 回傳翻譯結果。
  6. 將結果以事件流推播給前端。

- **部署設定（符合 Railway）**

  - 監聽 `0.0.0.0`
  - 使用 `process.env.PORT`
  - 提供 `/healthz` 端點
  - 環境變數：

    ```
    GLADIA_API_KEY=xxxx
    DEEPL_API_KEY=xxxx
    ALLOWED_ORIGINS=https://你的網域
    ```

  - 推薦 `railway.json`

    ```json
    {
      "$schema": "https://railway.com/railway.schema.json",
      "build": { "buildCommand": "npm ci && npm run build" },
      "deploy": {
        "startCommand": "node server/dist/index.js",
        "healthcheckPath": "/healthz"
      }
    }
    ```

---

## 🌐 API 對應架構

**外部 API：**

- GLADIA Realtime → 音訊轉文字
- DeepL API → 翻譯逐字稿

**內部資料流：**

```
Browser Mic 🎤
   ↓
[WebSocket /ws]
   ↓
[Express Server]
   ↓──▶ GLADIA API → Transcript (partial / final)
   ↓──▶ DeepL API → Translation (final only)
   ↓
Browser UI Render (上=原文，下=翻譯)
```

---

# 二、定義資料流與模組關係

### 🔁 整體資料流

1. **用戶操作**

   - 選擇輸入語言與輸出語言。
   - 點擊「開始錄音」。

2. **音訊流上傳**

   - 前端將音訊即時封包，透過 WebSocket 傳給後端。

3. **語音辨識**

   - 後端呼叫 GLADIA_API 取得逐字稿片段。
   - 每次 partial 結果即時傳回前端更新。

4. **翻譯處理**

   - 當句子為 final（確定句尾），後端呼叫 DeepL 取得翻譯。
   - 翻譯完成後推播回前端更新「下方區塊」。

5. **顯示結果**

   - 頁面上半部持續更新逐字稿。
   - 頁面下半部僅顯示完整翻譯句子。

6. **結束錄音**

   - 用戶按「停止」，WebSocket 關閉，會話結束。

---

### 🧩 模組關係

| 模組名稱                 | 功能                             | 對外介面             |
| ------------------------ | -------------------------------- | -------------------- |
| **Front-End UI**         | 音訊收集、顯示原文/翻譯          | `/ws`、`/api/*`      |
| **WebSocket Gateway**    | 管理音訊流、轉發至 GLADIA        | `/ws`                |
| **ASR Adapter (Gladia)** | 處理語音識別 API 請求            | Gladia API           |
| **Translator (DeepL)**   | 翻譯 final 句                    | DeepL API            |
| **Express API Layer**    | 管理 REST API、CORS、healthcheck | `/api/*`, `/healthz` |
| **Static File Server**   | 提供前端打包檔案                 | `/public/*`          |

---

# 三、UI Wireframe 與 API 文件

## 🧭 UI Wireframe（更新版）

```
+-----------------------------------------------------------+
| Header: Logo | 語言輸入 ▼ | 語言輸出 ▼ | ⚙ |
+-----------------------------------------------------------+
| 上：原文逐字稿（partial → final 高亮顯示）                |
| 下：翻譯結果（只顯示 final 翻譯）                        |
|                                                         |
|                                                         |
+-----------------------------------------------------------+
```

**互動說明：**

- 語言下拉：可動態切換語言（支援 zh / en / id / vi / th / pt / es / ja / ko）
- ⚙ 按鈕：切換「快速模式 / 精準模式」
- 錄音按鈕：開始 / 暫停 / 停止
- 翻譯結果即時更新，下方同步顯示最新 final 翻譯文字

---

## 🔌 API 文件（REST + WebSocket）

### **1. GET `/api/languages`**

取得支援語言列表。

```json
{
  "input": ["zh", "en", "id", "vi", "th", "pt", "es", "ja", "ko"],
  "output": ["zh", "en", "id", "vi", "th", "pt", "es", "ja", "ko"]
}
```

---

### **2. POST `/api/transcribe`**

非即時模式，供測試或上傳音訊檔使用。

```json
Request:
{ "audioUrl": "https://example.com/file.wav", "sourceLang": "ja" }

Response:
{ "transcript": "這是一段日文逐字稿。" }
```

---

### **3. POST `/api/translate`**

翻譯任意文字。

```json
Request:
{
  "text": "こんにちは",
  "sourceLang": "ja",
  "targetLang": "zh"
}

Response:
{ "translatedText": "你好" }
```

---

### **4. WebSocket `/ws`**

用於即時語音傳輸與結果推播。

**Client → Server**

```json
{ "type": "config", "sourceLang": "en", "targetLang": "es", "mode": "low-latency" }
{ "type": "audio", "seq": 1, "payload": "<base64 PCM>" }
{ "type": "control", "action": "stop" }
```

**Server → Client**

```json
{ "type": "transcript", "seq": 1, "text": "hello", "isFinal": false }
{ "type": "transcript", "seq": 2, "text": "hello world", "isFinal": true }
{ "type": "translation", "seq": 2, "text": "hola mundo", "isFinal": true }
```

---

### **5. GET `/healthz`**

健康檢查（Railway 檢測用）

```json
{ "ok": true }
```

---

## ✅ 系統效能與非功能需求

| 類別   | 要求                                                               |
| ------ | ------------------------------------------------------------------ |
| 效能   | 頁面載入 < 3 秒、API 回應 < 500ms、即時翻譯延遲 < 1.5 秒           |
| 安全性 | 防止 XSS、CSRF、API key 不暴露（僅伺服器端呼叫）                   |
| 相容性 | 支援最新兩版本的 Chrome / Edge / Safari / Firefox                  |
| 部署   | 以 GitHub 推送 → Railway 自動部署；支援 Dockerfile 或 railway.json |

---

## 🧠 開發建議給 Cursor

> 「請依據上述架構，建立 React + Express 專案，在 Railway 上自動部署。
> 前端：Vite + TailwindCSS。
> 後端：Express + WebSocket，使用 process.env.PORT、listen 0.0.0.0，含 /healthz。
> 整合 GLADIA 與 DeepL API，並實作語言選擇與即時逐字稿/翻譯顯示。」

---
